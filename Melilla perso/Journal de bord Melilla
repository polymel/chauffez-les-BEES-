J1 : Choix du projet - √©tablir le Cahier des charges - A qui se destine le projet , pour quelle utilit√© , avec quelles contraintes. 

Dans un prmeier temps on d√©termine le but global. Le but est de chauffer une riuche afin de faciliter le developpement de l'essaim. On identifie pour qui nous faisons ce projet; cela va faire varier le 
budge et le d√©lais. Ce porjet va se d√©rouler sur l'ann√©e scolaire, √† raison de 4 heures toutes les deux semaines + travail √† l'exterieur si besoin. Le budget est de 50 euros par ruche.

On d√©termine les diff√©rnets organes n√©cessaire : une source d'√©nergie (ici un panneau solaire+r√©gulateur), une actionneur (ici des resistances qui chauffent,un interrupteur), un automate (ESP32, le comparateur)
et des capteurs (ici les DS18B20, pour mesurer la temp√©rature de l'huile). On se sert d'une huile pour stocker l'√©nergie. 

Le but final, l'am√©lioration est d'utiliser la puissance maximum du syst√®me. 




B√™te √† corne 

OUI



J2 : Tester la tension √† vide du panneau solaire : besoin d'une fiche (connecteur RCA) , du panneau solaire et le mettre sous le n√©on. 
Le jour o√π il ferra beau faire le montage. 


Utiliser en s√©rie un amp√®re m√®tre et en parrall√®le un voltm√®tre. Utiliser une r√©sistance "r√©glable". 

Utiliser lush pour faire les sch√©mas 
1. Tester le panneau solaire: on remplace le panneau solaire par un g√©nerateur de thevenin 

Premi√®re √©bauche de la PCBA :
BOM: 

-ESP32, aliment√© en 3,3 V 
-R√©gulateur de tension (un seule composant) 
-Groupe comparateur (diode zener pour fixer une tension de seuil , une r√©sistance pour mettre une charge √† la diode, un comparateur) 
-un interrupteur pilot√© par l'ESP32 
- X r√©sistances

J'ai ajout√© √† l'aide de Simon Git dans VS Code. 


MPN et r√©ferences du materiel : 

Je me suis renseign√©e egalement sur le process du radiateur √† inertie fluide. 

C'est le principe sur lequel on base le chauffage des r√©sistances. 

Pour le liquide on peut choisir : De l‚Äôeau glycol√©e, De l‚Äôhuile, min√©rale ou v√©g√©tale. 
On appelle ces fluides :fluide caloporteur ou thermo-conducteur


r√©sistance, qui transforme le courant en chaleur ;

Est ce que les parois m√©talliques des r√©sistances conduisent ? comme les bains d'huile 

- : lourd, dur de r√©guler √† cause du temps de latence 
![alt text](image.png)


Trigger de Shmitt 
Une des application du Trigger de Shmitt est : r√©aliser des circuits de contr√¥le avec hyst√©r√©sis : thermostats, interrupteurs cr√©pusculaires, maintien du niveau dans une cuve. C'est donc pile ce que l'on veut.


Comment d√©finir les seuils inf√©rieur et superieur ? 
Tension min = tension √† partir de la quelle le syt√®me de fonctionnerait ples. 3,3 V? 
Tension max = tension √† partir de laquelle la temp√©rature est dangereuse pour les abeilles


Quelle est la temp√©rature dangereuse pour l'essaim ? 

pas de r√©gulateur de Tension sur lush project

Hyst√©r√©sis

J3
-------12/11-------

essai 

Le professeur nous donne des articles √† lire :

https://www.morningstarcorp.com/faq/what-are-the-different-types-of-solar-charge-controllers/#:~:text=All%20things%20being%20equal%2C%20MPPT,boost%20is%20not%20as%20significant.

https://www.ti.com/lit/ug/tidudj2/tidudj2.pdf?ts=1728344845244&ref_url=https%253A%252F%252Fwww.google.com%252F

https://www.ti.com/lit/an/slyt478/slyt478.pdf?ts=1728361811934

https://www.st.com/en/power-management/mppt-dc-dc-converters.html



Il nous donne aussi un INA 219. il nous permet de mesurer la tension et l'intensit√©. Il dessine de montage : un premier montage pour de test pour faire les mesures T/I avec l'INA 219 
et un autre "final" o√π l'INA sera int√©gr√© dans la carte 

*voir photo  "Montage avec INA 219 et final"*

Le capteur INA219 est un capteur de courant et de tension qui permet de mesurer la puissance √©lectrique √©chang√©e entre des appareils. Il communique avec l'Arduino via une interface I2C 
et est adapt√© √† la mesure de la puissance dans une cha√Æne de puissance.


je m'occupe de la partie code du : 


18B20 : Capteurs de temp√©rature

et de comment obtenir le fonctionnement du syst√®me √†n p arti d'une certaine tension (3,3 V ? tension de fonctionnement de l'esp) .
ce montage sera compos√© d'une diode zener , un comparateur et un abaisseur de tension ).


Je veux tester l'iDE arduino que j'ai t√©l√©charger. Le televersement ne fonctionne pas. Mon ordi ne reconnait pas la carte. 
J'ai d√©sinstaller et ret√©l√©charger l'ide. Telecharger d'autres drivers mais cela ne fonctionne pas. 


Difficult√©s rencontr√©es


T√©l√©versement du code sur l‚ÄôESP32 :

Probl√®me avec l'installation des pilotes.
V√©rifier si la carte ESP32 est bien s√©lectionn√©e dans l‚ÄôIDE Arduino et si les param√®tres de port s√©rie sont corrects.
Utiliser un code basique pour tester la communication avec la carte.

25/11


Objectif du jour :

R√©soudre le probl√®me de t√©l√©versement sur l‚ÄôESP32.
Tester et coder la gestion des capteurs DS18B20 pour lire la temp√©rature.


Je m'informe sur le capteur : 


On peut mettre plusieurs capteurs en s√©rie : 


Chaque capteur de temp√©rature DS18B20 poss√®de un code s√©rie 64 bits unique. Cela vous permet de c√¢bler plusieurs capteurs au m√™me c√¢ble de donn√©es.
Ainsi, vous pouvez obtenir la temp√©rature de plusieurs capteurs en utilisant une seule broche num√©rique Arduino.


source : 
https://www.raspberryme.com/guide-du-capteur-de-temperature-ds18b20-avec-arduino/


COmment brancher l'esp32 au capteur de temp√©rature ? 

Le capteur de temlp√©arature √† 2 pins

A quoi les brancher ? 


---- changement d'objectif du jour --> il faut commencer la fabrication du PCB donc il faut trouver commetn relier le panneau solaire  √† l'esp32 . 

comment alimenter l'esp32 avec l'enregie du panneau solaire ? 


 en Parlant avec Simon : 


Sch√©ma fonctionnel


Entr√©e : Le panneau solaire fournit une tension variable (par exemple, entre 12V et 18V).
Diode Zener et comparateur : V√©rifient si la tension est suffisante pour alimenter le syst√®me.
Abaisseur de tension (buck converter) : R√©gule la tension √† 3.3V pour alimenter l‚ÄôESP32.


Commment choisir les composants ? 




DIODE ZENER 
CHoix de la tension de la diode zener 6,8 V: on reagrde sur le diagramme P_Panneau_Solaire √† partir de quelle tension le panneau solaire fonctionne √† "pleine puissance". 

On observe que peut importe l'√©clairage, le panneau commence √† fonctionner autour de 10V. On doit choisir une tesnion en fonction de : 


on choisit une tension parmi les tensions standards des diodes : Diode zener valeurs standards . 

on d√©termine la valeur des composants entre le panneau solaire et l'esp32. 

Je me demandais pourquoi on choisissait 6,8 V alors qu'il y a des valeurs standards des diodes zener plus proche de 10v. 
Sauf que R2 va faire chuter la tension donc si on choissit une Zner avec une tension > 6,8 V , il est possible que le syt√®me ne 
sa'ctive pas √† partir de 10v re√ßu dans le panneau solaire. La r√©sistance aura fait chuter la tension de 10V. 

R2 : on fait une KVL pour d√©t√©rminer la valeur de la r√©sistance qui se situe entre la panneau solaire et la diode Zener . 

KVL : panneau solaire equivalent √† la generateur de tension avec 10V< tension <24V. + Ur2 (tension au borne de R2) + diode zener 
parfaite equivalent generateur de tension de 6,8 V. 


R2 = (tension max du panneau solaire - tension de la zener ) / cournant de R2. 

pour d√©terminer cournat de R2 IR2 : 

on doit avoir IR2 compris entre le cournat minimum de la zener et courant maximum  de la zener. Ces courants peuvent √™tre trouv√©s dans
la doc de la zener. 

Mais o√π parmis cette intervalle le Ir2 doit √™tre ? 

d√©ja √† quoi correspondent les bornes ? 


Izener min = courant minimal pour que la diode Zener fonctionne correctement en mode Zener , si Ir2 trop proche de Izener min la diode ne maintiendra pas la tension de claquage et la r√©gulation √©chouera.
Izener max = courant maximal que la diode Zener peut supporter sans surchauffe ou destruction.

il faut que pour la tension max du panneau solaire (26 V), le courant dans la diode (= Ir2 = IdiodeZ) doit √™tre  inferieur √† Izener max, sinon la diode claque.
il faut que pour la tension min de panneau solaire (10v), le cournat dans la diodde doit √™tre superieur √† Izener min, sinon la diode ne fonctionne pas. 

Il faut que Ir2 soit le plus proche possible de Izmin afin de ne pas faire chauffer la diode et ne pas l'user pr√©maturemment. 

√† partir de la doc de la znzer et des valeurs Izener min et Izener max on fait l'application num√©rique pour R2 :

J'ai du mal √† lire la doc : je ne trouve pas de Iz min et Izmax √† proprment parler. Il y a  Zerner Voltage Range mais il n' y a qu'une valeur de I
, il y a Maximum Zener Impedance et il y a Maximum Reverse Current mais je n

on lit dans la doc Izener min = 2mA. On voit sur le ghraphique que la zone du coude se termine √† 2mA. 
voir sh√©mas graphique d√©termination Izmin. 

Pour √™tre sur d'avoir passer la zone du coude et parce que la fabrication des composants est variable on prends Ir2 = 5mA. 

Determination de R2 pour Vps max/min avec Ir2 = 5ma :


Pour U panneau solaire = min = 10v et pour Ir2 = 5ma on a R2 = (10-6,8)/5*10^3 donc R2 = 640 omh. N'existe pas . 


POur la tension max dans le panneau ,quelle courant on aurait avce R2 = 640 ohm ? est ce qu'il serait < √† Iz max ? 

Iz pour u max panneau solaire = (26-6,8)/640= 0,03 A --> 30 mA<Iz max OK. 

820 ohm --> 24 mA √† 26 V ; ne d√©passe pas Izmax/2 pour la puissance max dissip√©e, on chosit cette valeur car elle existe dans les valeurs standards des 
r√©sistance et quelle est pr√©cautiuonneuse (loin du max). 


pour Izamx on lit dans la doc que la puissance max dissip√©e = 350 mW donc on fait 350/6,8 = 50 mA. 
donc IzMax = 50mA. 

voir "Sch√©mas alimentation de l'esp32 au panneau solaire"



COMPARATEUR DE PHASE 

Le comparateur active l'abaisseur de tension Si la tension du panneau est sup√©rieure au seuil. 


26/11

Objectif d'aujourd'hui : 

Finir le dimensionnementet choix des composants ( resistances du pdt, AOP et sa r√©sitance, et regulateur de tension)

j'ai r√©cup√©r√© la resistance gr√¢ce √† "valeur  R2". 

R√©sistances du PDT : 

V- de l'AOP est fix√© √† Vdiode zener = 6,8v. 
Lorsque V+ > Vdiode zener on a Vsortie AOP = + Vcc

On fixe une des deux r√©sistances du PDT : 

on veut 6,8 v au borne de R4 avec Vpanneausolaire = 10v pour que au minmium on est bien la sortie de l'AOP qui alimente 
le regulateur ( puis le reste de circuit ).


je fais le sch√©mas du R2 + PDV + diode + resistance de la Diode 

je n'arrive pas √† connEceter le fils sur les noeuds; il y a des noeuds fix√©s sur les fils il faut relier les composants sur ses noeuds.

M. Peter m' a fait changer un AOP pour un comparateur. 

La simulation Lush fonctionne : je fixe R4 √† 1000 ohm. Tandis que je fais varier R3 pour finir par avoir 6,8 aux bornes de R4. 
 donc R3 = 470 ohm et R4 = 1000 ohm.
voir D√©trermination R3 et R4 sans valeurs standards des r√©sistances.png

on remet un AOP car on se sait pas comment fonctionne le comparateur. 

On ajoute dans la simulation un condensateur (+ resistance sinon la simulation ne fonctionne pas)  qui fonctionnera avec le panneau solaire. 

On multiplie par 10 la valeur des resistances R3 et R4 du PDT afin de reduire la conso d'energie.

resultat de simulation avce R3 = 4700 ohm et R4 = 10000 ohm

On rajoute une r√©siatnce en V+ et la sortie --> √† quoi cela peut servir ? 


Prochaine fois : 
rajouter une resistance en sortie de l'AOP et et trouver les mpn de l'AOP et du regulateur 

09/12

Le MPN de l'AOP a √©t√© donn√© par le prof. AP331A.



Resistance AOP 

La resistance de l'AOP permet de neutraliser la chute de tension engendr√©e par la fermeture de l'interrupteur 
lors de la bascule de 0 √† V+. 


La target est d'avoir la resistance la plus petite possible. Cependant  il faut diminuer la valeur de la resistance
jusqu'√† la limite de bascule de l'AOP. 

on cherche √† avoir la plus petite valeur de R AOP afin d'avoir le delta de tension plus √©lev√©e que la chute de tension.

voir SImulation pour d√©termination de RAOP. 

On utilise le principe du trigger de Shmitt, voir "Target de Shmitt".

La "Target de Schmitt" consiste √† optimiser les seuils d'hyst√©r√©sis et la r√©sistance AOP pour que :

La bascule soit stable et fiable.
Le delta de tension soit suffisamment grand pour compenser les chutes de tension induites par les charges connect√©es.

Essai de differentes valeurs pour R AOP :

1 K pas de bascule 
10 K pas de bascule
11 K pas de bascule
12 K pas de bascule
13 K bascule
15 K bascule


La bascule se fait √† partir de 13K mais la valeur normalis√©e la plus proche et au dessus de 13k et 15K.

R AOP = 15k ohm.



Quel regulateur de tension doit √™tre utilis√© ? 

est ce que le MPN est impos√© ? Simon a d√©j√† trouv√© 


------------------PARTIE PROGRAMMATION----------------


Place √† la deuxi√®me partie de mon travail : repondre au besoin de lecture de temp√©rature √† l'aide du BUS des capteurs. 

ESP32           DS18B20 (x5)
------          -----------
3.3V   ------>  VDD (tous en parall√®le)
GND    ------>  GND (tous en parall√®le)
GPIO4  ------>  DATA (tous en parall√®le)
          4.7 kŒ© entre DATA et 3.3V resitance de pull-up.

Les capteurs DS18B20, comme d'autres dispositifs utilisant le protocole OneWire, partagent une seule ligne de donn√©es pour communiquer. Cette ligne est utilis√©e pour transmettre des donn√©es entre les capteurs et le microcontr√¥leur (dans ce cas, l'ESP32).

Comportement de la ligne de donn√©es :
Lorsque le capteur ou le microcontr√¥leur ne communique pas, la ligne doit √™tre maintenue √† un niveau haut (logique "1").
Lorsque le capteur envoie des donn√©es, il abaisse volontairement la ligne de donn√©es √† un niveau bas (logique "0") pendant un court instant.
Probl√®me sans pull-up :
Si la ligne de donn√©es n'est pas maintenue √† un niveau haut lorsque le capteur n'est pas actif, la ligne pourrait "flotter", c'est-√†-dire qu'elle pourrait prendre une valeur ind√©termin√©e, ce qui entra√Æne des comportements erratiques ou des erreurs de communication.
Fonction de la r√©sistance pull-up :
La r√©sistance pull-up relie la ligne de donn√©es √† l'alimentation (g√©n√©ralement 3.3V ou 5V), assurant ainsi que la ligne soit au niveau haut (logique "1") lorsqu'aucun capteur n'envoie de signal.
Comment √ßa fonctionne dans le cas du DS18B20 ?
Lorsque le DS18B20 n'envoie pas de donn√©es, il laisse la ligne √† haut (logique "1"), ce qui est rendu possible gr√¢ce √† la r√©sistance pull-up.
Lorsque le DS18B20 veut envoyer un bit √† 0, il tire la ligne de donn√©es vers le bas (logique "0").
Lorsque le DS18B20 veut envoyer un bit √† 1, il laisse la ligne de donn√©es √† haut, et la r√©sistance pull-up assure que la ligne reste dans cet √©tat.
Valeur typique de la r√©sistance pull-up :
La valeur standard pour cette r√©sistance est souvent 4.7 kŒ©, bien que des valeurs comme 10 kŒ© puissent √©galement fonctionner dans certains cas.

Les biblioth√®ques √† utiliser sont les : 


Pour connecter 5 capteurs de temp√©rature DS18B20 √† un ESP32 et enregistrer leurs temp√©ratures avant de les transmettre, voici les √©tapes d√©taill√©es :

Mat√©riel n√©cessaire
1 x ESP32.
5 x DS18B20.
1 x r√©sistance de 4.7 kŒ© (pull-up).
Breadboard et c√¢bles de connexion.
C√¢blage
Les DS18B20 fonctionnent sur le principe d'une liaison en bus unique (OneWire), ce qui signifie que tous les capteurs partagent la m√™me ligne de donn√©es. Voici comment les connecter :

√âtapes :
Alimentation :

Relie les broches VDD de tous les DS18B20 √† la broche 3.3V de l‚ÄôESP32.
Relie toutes les broches GND des DS18B20 au GND de l‚ÄôESP32.
Ligne de donn√©es :

Relie toutes les broches DATA des DS18B20 ensemble.
Connecte cette ligne DATA √† une broche GPIO de l‚ÄôESP32 (par exemple, GPIO4).
R√©sistance pull-up :

Place une r√©sistance de 4.7 kŒ© entre la ligne DATA et 3.3V.
Sch√©ma de c√¢blage
plaintext
Copier le code
ESP32           DS18B20 (x5)
------          -----------
3.3V   ------>  VDD (tous en parall√®le)
GND    ------>  GND (tous en parall√®le)
GPIO4  ------>  DATA (tous en parall√®le)
          4.7 kŒ© entre DATA et 3.3V
Programmation
L'ESP32 devra g√©rer plusieurs capteurs sur une m√™me ligne OneWire. Chaque capteur poss√®de une adresse unique (ROM) qui permet de les identifier individuellement.

Biblioth√®ques n√©cessaires :
OneWire.
DallasTemperature.

je fais des test avec la plaquette ,  2 capteurs, la resistance de pull-up et l'esp32. 

L'ordinateur sert d'alimentation avec l'usb. 

je n'arrive pas √† televrerser dans la carte. je colle les codes erreurs dans chat GPT pour essayer de debugger. 

voir image "Montage t√©l√©versement"

Prochaine s√©ance : arriver √† t√©leverser le programme


07/01 


Bonne ann√©e !! 

TO do du jour : 

- T√©leverser le programme
#include <OneWire.h>
#include <DallasTemperature.h>

// Configuration des broches
#define ONE_WIRE_BUS 4 // GPIO4 pour DATA

// Initialisation du bus OneWire
OneWire oneWire(ONE_WIRE_BUS);

// Initialisation de la biblioth√®que DallasTemperature
DallasTemperature sensors(&oneWire);

void setup() {
  Serial.begin(115200);
  sensors.begin();

  Serial.println("Recherche de capteurs...");
  int numberOfDevices = sensors.getDeviceCount();
  Serial.print("Nombre de capteurs d√©tect√©s : ");
  Serial.println(numberOfDevices);

  if (numberOfDevices == 0) {
    Serial.println("Aucun capteur d√©tect√©. V√©rifiez le c√¢blage.");
  }
}

void loop() {
  sensors.requestTemperatures(); // Demande des temp√©ratures √† tous les capteurs
  Serial.print("Temp√©rature capteur 1 : ");
  Serial.println(sensors.getTempCByIndex(0)); // Lecture du premier capteur
  Serial.print("Temp√©rature capteur 2 : ");
  Serial.println(sensors.getTempCByIndex(1)); // Lecture du deuxi√®me capteur

  delay(1000); // Pause d'une seconde entre les lectures
}
Parameterage de l ide

Ouvrez l'IDE Arduino.

Allez dans Fichier ‚Üí Pr√©f√©rences.

Dans le champ URL de gestionnaire de cartes suppl√©mentaires, ajoutez l'URL suivante :

bash
Copier le code
https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
Astuce : Si une URL est d√©j√† pr√©sente, s√©parez-les par une virgule.

Ensuite, allez dans Outils ‚Üí Gestionnaire de cartes.

Recherchez "ESP32" et installez le package officiel de Espressif Systems.

2. Choisir la bonne carte
Pour votre carte sp√©cifique "WiFi LoRa 32 (V3)" :

Allez dans Outils ‚Üí Type de carte ‚Üí ESP32 Arduino.
Recherchez et s√©lectionnez la carte "ESP32 Dev Module".
--> ne fonctionne pas 


modif : 

 Outils ‚Üí Type de carte
ESP32S3 Dev Module


T√©l√©versement r√©ussi : Les √©tapes de compression, d'√©criture, et de v√©rification des donn√©es se sont d√©roul√©es sans erreur.
Chip d√©tect√© : ESP32-S3 (QFN56) avec 8MB de flash int√©gr√©.
Baud rate : La communication a utilis√© un d√©bit efficace de 921600 baud.
Hard resetting via RTS pin : Le microcontr√¥leur a red√©marr√© automatiquement apr√®s le t√©l√©versement.


Je veux maintenant tester le programme :


Je configure le moniteur S√©rie. 


J'ai maintenant ce message :


Temp√©rature capteur 2 : -127.00
Temp√©rature capteur 1 : -127.00



Le message indiquant Temp√©rature capteur 1 : -127.00 signifie que le microcontr√¥leur (ESP32) n'arrive pas √† lire correctement les capteurs DS18B20.


1 . j'ai v√©rifi√© les branchement en re regardant les pins map de l'esp32 et du capteur : 
Le GPIO n'√©tait pas le bon #define ONE_WIRE_BUS 7 // GPIO7 pour DATA j'ai chang√© le "4" pour "7" car le c√¢blage √©taot sur le 7 !!! 

Cela ne fonctionne toujours pas , puis apr√®s enfoncage des composants/c√¢ble cela fonctionne ! 


Le capteur 1 d√©t√©cte 19 degr√®s tandis que le 2 - 127 car il n'est toujours pas branch√©. 


Mon thermom√®tre affiche quant √† lui il affiche 16 degr√®s. 

La mesure est surement fauss√©e car les capteurs ont √©t√© manipul√©s. 

Il faut donc prendre en compte cela : les prises de temp√©ratures sont sensibles aux manipulations. 

J'attends de voir si la mesure tend √† la valeur de celle du thermom√™tre. 

Cela met en avant l'importance de la m√©trologie et de la tol√©rance des appareils : un degr√®s de trop pourrait tuer les abeilles. 

Par principe de suret√© je conseille de mettre un sueil max qui est d'au moins un degr√®s de moins que la temp√©rature max support√©e par l'essaim. 

j'aiDE Laura a t√©ste son code car il "ne focntionne pas sur son ordinateur". 

il faut c√¢bler l'ina aux montage d√©j√† existant  :


je suis la doc pour la c√¢blage : 


j'utilise une led pour mesurer la tension et le cournant. 


25/02/2025 -

Besoin de faire un point avec l'equipe 

Fait : 
routage PCB
commande du PCB --> arriv√©  27/02

d√©finition des composants 
code capteur de temp√©rature 
code complet lecture temperature - lecture courant tension 
Schemas electronique 

Reste √† faire : 

verifier commande des composants OK
finaliser code complet lecture temperature - lecture courant tension 
appro. huile 
v√©rification code  lecture courant/tension --> adaptation  mppt avec methode PWM
Montage des composants 
d√©finir un plan de test PCBA 

apr√®s verifi PCBA : 
definir contenant huile OK 
essayer sur la ruche 

id√©es : 

export de donn√©es pour exploitation 

trou dans la raquette :

workshop mppt : essai plusieurs puissances source de lumi√®re , rester au point 


28/02/2025

objectif du jour :
comprendre les notions mppt et Mpp

article 3 : https://www.ti.com/lit/an/slyt478/slyt478.pdf?ts=1728361811934

Une caract√©ristique des panneaux solaires est que leur tension de sortie diminue √† mesure que le courant pr√©lev√© augmente. 


M√©thode des 2 points : pour fonctionner √† 90 % du MPP consiste √† activer la charge au Point 1 et la d√©sactiver au Point 2
Lorsque la charge est activ√©e, elle consomme de la puissance, ce qui fait baisser la tension du panneau. Cela d√©place le point de fonctionnement du Point 1, en passant par le MPP, jusqu‚Äôau Point 2. √Ä ce point, la charge est d√©sactiv√©e, ce qui permet √† la tension du panneau de remonter.*

d√©fis de la m√©thode des 2 points : 

- Adaptation de la tension : la charge (ici les r√©sistances chauffantes) et le panneau solaire ne sont pas √©gales. ==> besoin de  convertir la tension
-  Gestion des variations rapide la tension du panneau 
- Ajouter un superviseur de tension d‚Äôalimentation pour activer ou de d√©sactiver l‚Äôalimentation √©lectrique en fonction de la tension du panneau solaire 



interruption : j'aide Laura a t√©ste son code. je debug 






10/03/25

A faire aujourd'hui : 

- Assembler les PCBAs
- d√©finir une spec de test 
- COnclure l'inclusion du MPPT PWM dans la programmation 


Je reviens sur la m√©thode des 2 points : 

pour mettre en place cette m√©thode on a besoin du TPS62125 un r√©gulateur de tension cependat nous avons utiliser le 

est ce que le regulateur que l'on a choisit a les m√™mes caract√©ristiques que celui propos√© dans l'article ? 
Comment trouver les 2 points ? 

On doit d√©terminer une formule dynamique qui calcule P1 et P2. P& et P2 doivent √™tre d√©termioner de mani√®re dynamique puisque 
l'ensoleillment varie. 

Est ce qu'on a mis les composnats autour ? 

Alors notre configuration est tr√®s diff√©rente que celle dans l'article. 
On doit d√©terminer √† partir du bloc de l'INA 219 les formule P1 et P2. 

Quels sont les param√®tres de P1 et P2 ? 




S√©rigraphie du PCB : on √©tale la p√¢te √† braser sur le pochoir fix√© √† l'aide de pince sur le PCB. 

voir image s√©rigraphie




Changement de technique pour rester au pwm :


faire varier le trapport de cycle en fonction de la variation de la tension/courant


S√©rigraphie + montage d'un autre PCB : erreur rencontr√©e --> lavage du PCB √† l'alcool on refait le lendemain. 


11/03/25

Pr√©vue aujourd'hui : 

- Code avec la nouvelle m√©thode pour garder le pwn 
-Assemblage de le seconde carte 


Principe de la modulation de rapport de cycle : 

La tension varie en fonction de l'ensoleillement et des conditions de fonctionnement du panneau solaire. Si la tension augmente, cela signifie qu'il y a plus de puissance disponible, et vice versa. 
En ajustant le rapport cyclique du PWM en fonction de la tension mesur√©e, vous pouvez r√©guler la quantit√© d'√©nergie transmise √† la r√©sistance chauffante

1. Mesurer la tension et le courant du panneau solaire avec l‚ÄôINA219. --> code existant 


2 . Calculer la puissance disponible + Ajustement du rapport cyclique du PWM en fonction de cette puissance.
Si beaucoup de puissance est disponible, on augmente le PWM.
Si la puissance diminue, on r√©duit le PWM pour ne pas surcharger le panneau.


-----------erreur de montage sur la premi√®re carte on change R1 mont√©e 4,7k omh avec un 470 omh---------------------

J'utilise chatGPT pour le developpement du code 2.

#include <Wire.h>
#include <Adafruit_INA219.h>

Adafruit_INA219 ina219;

const int pwmPin = 5;      // Broche de sortie du PWM (√† connecter √† la r√©sistance chauffante)
const int pwmChannel = 0;  // Canal PWM utilis√© par l'ESP32
const int pwmFreq = 1000;  // Fr√©quence PWM (1 kHz)
const int pwmResolution = 8; // R√©solution en bits (0-255)

void setup() {
    Serial.begin(115200);
    Wire.begin(); // Initialisation du bus I2C

    // V√©rifier que l'INA219 fonctionne
    if (!ina219.begin()) {
        Serial.println("√âchec de la connexion √† l'INA219 !");
        while (1);
    }
    
    Serial.println("INA219 initialis√© !");
    
    // Initialisation du PWM
    ledcSetup(pwmChannel, pwmFreq, pwmResolution);
    ledcAttachPin(pwmPin, pwmChannel);
}

void loop() {
    // Lire la tension et le courant du panneau solaire
    float tension = ina219.getBusVoltage_V();
    float courant = ina219.getCurrent_mA() / 1000.0; // Convertir en A
    float puissance = tension * courant; // Calcul de la puissance (P = U √ó I)

    // D√©finir la valeur du PWM en fonction de la puissance disponible
    int pwmValue = map(puissance, 0, 10, 0, 255); // Adapter selon la plage de puissance r√©elle

    // Limiter la valeur du PWM entre 0 et 255
    pwmValue = constrain(pwmValue, 0, 255);

    // Appliquer le PWM √† la r√©sistance chauffante
    ledcWrite(pwmChannel, pwmValue);

    // Afficher les valeurs sur le moniteur s√©rie
    Serial.print("Tension : "); Serial.print(tension); Serial.print(" V, ");
    Serial.print("Courant : "); Serial.print(courant, 3); Serial.print(" A, ");
    Serial.print("Puissance : "); Serial.print(puissance); Serial.print(" W, ");
    Serial.print("PWM : "); Serial.println(pwmValue);

    delay(1000); // Attendre 1 seconde avant la prochaine mesure
}


erreure rencontr√©e : C:\Users\melim\Documents\Etude\POLYTECH\4A\S7\Projet √©lectronique\32\32.ino: In function 'void setup()':
C:\Users\melim\Documents\Etude\POLYTECH\4A\S7\Projet √©lectronique\32\32.ino:10:3: error: 'ledcSetup' was not declared in this scope
C:\Users\melim\Documents\Etude\POLYTECH\4A\S7\Projet √©lectronique\32\32.ino:11:3: error: 'ledcAttachPin' was not declared in this scope; did you mean 'ledcAttach'?

exit status 1

Compilation error: 'ledcSetup' was not declared in this scope


je teste un code simple pour v√©fier la connxion de mon ESP32 et mon environnement : 
void setup() {
  Serial.begin(115200);  // Initialise la communication s√©rie
  delay(1000);  // Pause pour stabiliser
  Serial.println("ESP32 OK");
}

void loop() {
  Serial.println("ESP32 fonctionne !");
  delay(1000);  // Attendre 1 seconde
}


--- en parrall√®le on remonte le PCBA + on le met au four --- 

Utilisation du four : cycle √† vide + cycle "C3 pour cuire la PCBA


* photo four **
Pr√©caution : chaleur importante et pas de moyen de protection 
On inspecte la carte visuellement => * image inpestion * 
explication installation broche pour t√©l√©verser : 

RX	R√©ception (UART)	Lire des donn√©es d‚Äôun PC, capteur s√©rie
TX	Transmission (UART)	Envoyer des donn√©es √† un PC, autre microcontr√¥leur
GND	Masse	Connexion de r√©f√©rence pour tous les composants
RST	Reset	Red√©marrer l‚ÄôESP32
3.3V	Alimentation	Alimenter des modules (capteurs, √©crans, etc.)


-- Brasage manuel des caPteur ==> difficult√©s rencontr√©es : ponts entre les pins, peut √™tre du √† la taille de la tige. 

24/03 

Ordre du jour : 

1. reprise des composants bras√©s manuellement 
2. mesures des caract√©ristiques du panneau solaire √† l'aide du r√©austat


2.1 Montage th√©orique 

Materiel n√©cessaire : 

- R√©austat 
-2 multim√™tres 
-panneau solaire 
- fiches bananes 
- Lumi√®re variable 
- Autotransfo 



Determination du sch√©mas : 

voir photo Montage mesure caract√©ristique panneau solaire .jpg

point de vigilance : comment monter les multim√™tres ? 

-> le voltm√™tre se branche en parrall√®le √† la charge : Le voltm√®tre mesure la diff√©rence de potentiel √©lectrique entre deux points d'un circuit.
La tension est la diff√©rence de potentiel entre deux points, donc pour mesurer cette diff√©rence, il doit √™tre connect√© en parall√®le aux deux points o√π la tension est √† mesurer.

voir photo choix montage amp√®rmetre 
-> L'amp√®rem√™tre : Un amp√®rem√®tre doit toujours √™tre connect√© en s√©rie avec le circuit dont tu veux mesurer le courant, car il doit permettre au courant de passer √† travers lui.
On peut soit mettre l'amp√®remetre dans le branchment du voltm√™tre soit en dehors. 

Cela d√©pend de l'imp√©dance caract√©ristique du multim√™tre.  le multi peut √™tre num√©rique ou √† aiguille. 
Dans le premier cas : on a Z proche de 1 m√©ga ohm. - photo autotransfo --

Tandis que dans un m√©canisme √† aiguille on a un bobinage unique avec un curseur qui fait varier le rapport de spear et donc la tension secondaire entre 0 et 230 V. Ce bobinage 
est en s√©rie avec une r√©sistance et celle ci √† une valeur << √† 1 mega ohm. 

On choisira alors de mettre l'amp√®rem√™tre dans la boucle et oon peut n√©gliger ainsi la cournat du voltm√®etre. 



2.2 montage pratique 

Voir image montage physique 


Rq = : le panneau solaire chauffe entre chaque mesure il faut le laisser refroidire. Les panneaux solaire perdent en puissance lorsqu'ils chauffent => les panneaux solaires 
sur les toits ne doivent pas √™tre coll√©s au toit des maison mais devraient laisse circuler l'air. 

Les resultas experimentaux suivent les r√©sultats th√©oriques attendus. 

On a deux varibales √† mesurer : la tension et le courant. 
On a 2 variables √† faire varier : le r√©austat et l'intensit√© lumineuse avec l'auto transformateur. 
On augmente la prise de point entre 20 et 20 ohm car c'est la que ce trouve le pwm  => rectification c'est entre 1200 et 300



rq : on a pas de valeur pour A = 0 


25/03/25 


Retex 24/03 : prise des mesures pour 3 intensit√©s lumineuses 

ordre du jour : 


1. reprise des composants bras√©s manuellement 
2. continuer mesures des caract√©ristiques du panneau solaire √† l'aide du r√©austat
3.Analyse des mesures 

On re installe le montage 


rq : on est oblig√© de faire des pauses fr√©quente car le panneau chauffe 
voir influence de la temp√©rature sur les mesures .jpg


besoin de faire l'algo 

on trace ne plus P en fontion de U -> cela nous sera utile dans le but de d√©finir les 2 bornes n√©cessaires √† l'algo mppt


INFO / passage de fournissement de 220 √† 230 V par EDF car moins de pertes √† 230 V

on observe que pour des puissances lumineuses comprise entre 260 et 750 W/M^2 on a une puissance compriuse entre 0,02 et 0,2 W tandis aque pour l'
intensit√© luminuse max √† 2000 w/m^2 on a une puissance comprise netre 0,6 et 6 W. 

La puissance du panneau semble faible.

Quelle est l'ordre de grandeur luminuse du soleil en W/m^2 ? 

source chat GPT : L'ordre de grandeur de la puissance lumineuse du Soleil est d‚Äôenviron 1361 W/m¬≤ au niveau de la limite de l‚Äôatmosph√®re terrestre (c'est la constante solaire).

üìå Sur Terre, apr√®s absorption et diffusion par l‚Äôatmosph√®re, l‚Äôensoleillement maximal atteint environ :

1000 W/m¬≤ en plein midi, par temps clair et sans obstacle. ==> on va faire un mesure √† 1000

200 √† 500 W/m¬≤ par temps nuageux. ==> on a d√©j√† des mesures proches de ces grandeurs 

0 W/m¬≤ la nuit. 

Pour lever le doute prise de mesure en exterieur => modification de l'instalation en prenant des multim√™tre pas sur secteur 


Pour mesurer les courbes caract√®ristiques de panneau solaire : 
1.Choisir une tension d'alimentation gr√¢ce √† l'autotransfo 
2. Faire varier la r√©sistance 

07/04/25

Fait √† la derni√®re s√©ance : 

-Prise  de mesure courbe VI en exterieur √† 16h 

A faire cette s√©ance : 

- Prendre mesure autours de 12h plein soleil 
-Mesurer l'impact de la chaleur sur la prise de puissance du panneau =>pas assez important et pas urgent 
-Appliquer la PWM aux courbes prises => 


- Refl√©xion sur l'algo de gestion du MPPT en fonction des courbes trac√©es
https://www.researchgate.net/publication/325203523_Conception_d'un_regulateur_solaire_avec_commande_MPPT

=> adaptation du process de l'article √† notre cas 

Besoin de d√©terminer une equation du tableau V et ppt => pour avoir un intervalle continue consitut√© √† partir de prise de valeurs discretes 

Utiliser ligne de tendance pour d√©terminer l'equation 


comment augmenter alpha ? 

le rapport cyclique alp$ha pest compris entre 0 et 1. 

On commence le alpha √† 0 pour ne pas avoir de regime transitoire. 

apr√®s explication de l'algo √† Mistral on trouve : 
------------------------------------------------------
void loop() {
  // Lire les valeurs actuelles de tension et de courant
  float currentVoltage = ina219.getBusVoltage_V();
  float currentCurrent = ina219.getCurrent_mA() / 1000.0; // Convertir en Amp√®res

  // Calculer la puissance actuelle
  float currentPower = currentVoltage * currentCurrent;

  // Comparer la puissance actuelle avec la puissance pr√©c√©dente
  static float previousPower = currentPower;
  if (currentPower > previousPower) {
    // Si la puissance augmente, v√©rifier la tension
    if (currentVoltage > previousVoltage) {
      // Si la tension augmente, diminuer le rapport cyclique
      pwmValue -= 0.01;
    } else {
      // Si la tension diminue, augmenter le rapport cyclique
      pwmValue += 0.01;
    }
  } else {
    // Si la puissance diminue, v√©rifier la tension
    if (currentVoltage > previousVoltage) {
      // Si la tension augmente, diminuer le rapport cyclique
      pwmValue -= 0.01;
    } else {
      // Si la tension diminue, augmenter le rapport cyclique
      pwmValue += 0.01;
    }
  }

  // Limiter pwmValue entre 0 et 1
  pwmValue = constrain(pwmValue, 0.0, 1.0);

  // Mettre √† jour le rapport cyclique PWM
  int pwmDutyCycle = (int)(pwmValue * 255);
  ledcWrite(0, pwmDutyCycle);

  // Mettre √† jour la puissance pr√©c√©dente
  previousPower = currentPower;

  // Afficher les valeurs sur le moniteur s√©rie
  Serial.print("Tension: ");
  Serial.print(currentVoltage);
  Serial.print("V Courant: ");
  Serial.print(currentCurrent);
  Serial.print("A Puissance: ");
  Serial.print(currentPower);
  Serial.print("W Rapport Cyclique: ");
  Serial.println(pwmValue);

  // Attendre un peu avant la prochaine lecture
  delay(1000);

-------------------------------------------------------------
Rq : ce code reprend l'algo avce les 4 etats et affiches les metriques.

Ensuite j'enl√®ve les parties qui ne m'interessent pas pour lemoment dans le code de l'esp32: je conserve la lectuore de V avce l'ina 
----------------------------------------Code INA--------------------
J'ajoute le code de lecture des P et V avec l'INA, puis j'essaie de compiler. 
#include <Wire.h>
#include <OneWire.h>
#include <DallasTemperature.h>

//pour INA219 bibliotheque Adafruit

#include <Adafruit_INA219.h>
Adafruit_INA219 ina219;

// D√©finition des broches
#define SDA_PIN 21
#define SCL_PIN 22
#define ONE_WIRE_BUS 14   // Broche du DS18B20 (DATA_temp)


// #define SIGNAL_1 24  
// #define SIGNAL_2 29



// Initialisation du bus OneWire et du capteur
OneWire oneWire(TEMP_SENSOR_PIN);


void setup() {
  Serial.begin(115200);  // Initialise le port s√©rie
    while (!Serial) {
      delay(1);
  }
  Serial.print("ESP32 connected to UART\n");
  //temp config
  // Start up the library for temp sensor
  sensors.begin();
  // Grab a count of devices on the wire
  numberOfDevices = sensors.getDeviceCount();
   // locate devices on the bus
  Serial.print("Locating temp sensors devices...");
  Serial.print("Found ");
  Serial.print(numberOfDevices, DEC);
  Serial.println(" devices.\n");
 // Loop through each device, print out address
  for(int i=0;i<numberOfDevices; i++) {
    // Search the wire for address
    if(sensors.getAddress(tempDeviceAddress, i)) {
      Serial.print("Found device ");
      Serial.print(i, DEC);
      Serial.print(" with address: ");
      printAddress(tempDeviceAddress);
      Serial.println();
		} else {
		  Serial.print("Found ghost device at ");
		  Serial.print(i, DEC);
		  Serial.print(" but could not detect address. Check power and cabling\n");
		}
  }
  //end temp config

    // Configuration de l'I2C
    Wire.begin(SDA_PIN, SCL_PIN);
    Serial.println("I2C initialis√©");


  //INA219 
  uint32_t currentFrequency;
  if (! ina219.begin()) {
    Serial.println("Failed to find INA219 chip");
    while (1) { delay(10); }
  }else{
    Serial.println("INA219 initialis√©");
  }
  

    // // Configurer les GPIO comme entr√©es ou sorties
    // pinMode(SIGNAL_1, INPUT);
    // pinMode(SIGNAL_2, INPUT);

}


  }
    // // Lire les signaux num√©riques
    // int signal1 = digitalRead(SIGNAL_1);
    // int signal2 = digitalRead(SIGNAL_2);
    // Serial.print("Signal 1: "); Serial.println(signal1);
    // Serial.print("Signal 2: "); Serial.println(signal2);

    // // V√©rifier la communication s√©rie avec un p√©riph√©rique externe
    // if (Serial1.available()) {
    //     char c = Serial1.read();
    //     Serial.print("Re√ßu sur UART: ");
    //     Serial.println(c);
    // }
  float shuntvoltage = 0;
  float busvoltage = 0;
  float current_mA = 0;
  float loadvoltage = 0;
  float power_mW = 0;

  shuntvoltage = ina219.getShuntVoltage_mV();
  busvoltage = ina219.getBusVoltage_V();
  current_mA = ina219.getCurrent_mA();
  power_mW = ina219.getPower_mW();
  loadvoltage = busvoltage + (shuntvoltage / 1000);
  


  delay(2000);
}

}

Je vais devoir faire un montage pour tester cela : 

RQ : et pourquoi on ne commencerez pas avce un rapport cyclique √† 0,5 pour √™tre au milieu de l'intervalle.



Code merg√© : 

#include <Wire.h>
#include <Adafruit_INA219.h>

// Initialisation de l'INA219
Adafruit_INA219 ina219;

// D√©finition des broches
#define SDA_PIN 21
#define SCL_PIN 22
#define PWM_PIN 25  // Broche pour le signal PWM

// Variable pour le rapport cyclique PWM
float pwmValue = 0.5; // Valeur initiale (50% de rapport cyclique)

void setup() {
  Serial.begin(115200);  // Initialise le port s√©rie
  while (!Serial) {
    delay(1);
  }
  Serial.println("ESP32 connected to UART");

  // Configuration de l'I2C
  Wire.begin(SDA_PIN, SCL_PIN);
  Serial.println("I2C initialis√©");

  // Initialisation de l'INA219
  if (!ina219.begin()) {
    Serial.println("Failed to find INA219 chip");
    while (1) { delay(10); }
  } else {
    Serial.println("INA219 initialis√©");
  }

  // Configuration du PWM
  ledcSetup(0, 5000, 10); // Canal 0, fr√©quence 5kHz, r√©solution 10 bits
  ledcAttachPin(PWM_PIN, 0);
}

void loop() {
  // Lire les valeurs actuelles de tension et de courant
  float currentVoltage = ina219.getBusVoltage_V();
  float currentCurrent = ina219.getCurrent_mA() / 1000.0; // Convertir en Amp√®res

  // Calculer la puissance actuelle
  float currentPower = currentVoltage * currentCurrent;

  // Comparer la puissance actuelle avec la puissance pr√©c√©dente
  static float previousPower = currentPower;
  static float previousVoltage = currentVoltage;

  if (currentPower > previousPower) {
    // Si la puissance augmente, v√©rifier la tension
    if (currentVoltage > previousVoltage) {
      // Si la tension augmente, diminuer le rapport cyclique
      pwmValue -= 0.01;
    } else {
      // Si la tension diminue, augmenter le rapport cyclique
      pwmValue += 0.01;
    }
  } else {
    // Si la puissance diminue, v√©rifier la tension
    if (currentVoltage > previousVoltage) {
      // Si la tension augmente, diminuer le rapport cyclique
      pwmValue -= 0.01;
    } else {
      // Si la tension diminue, augmenter le rapport cyclique
      pwmValue += 0.01;
    }
  }

  // Limiter pwmValue entre 0 et 1
  pwmValue = constrain(pwmValue, 0.0, 1.0);

  // Mettre √† jour le rapport cyclique PWM
  int pwmDutyCycle = (int)(pwmValue * 1023); // Utiliser la r√©solution 10 bits
  ledcWrite(0, pwmDutyCycle);

  // Mettre √† jour la puissance pr√©c√©dente et la tension pr√©c√©dente
  previousPower = currentPower;
  previousVoltage = currentVoltage;

  // Afficher les valeurs sur le moniteur s√©rie
  Serial.print("Tension: ");
  Serial.print(currentVoltage);
  Serial.print("V Courant: ");
  Serial.print(currentCurrent);
  Serial.print("A Puissance: ");
  Serial.print(currentPower);
  Serial.print("W Rapport Cyclique: ");
  Serial.println(pwmValue);

  // Attendre un peu avant la prochaine lecture
  delay(1000);
}

11/04/25

fait la derni√®re fois : 

- Adaptation de l'algo d'adaptation de alpha 

√† faire cette fois : 

- faire un montage qui permet de tester l'algo ? Est ce utile ? 
- Ajouter le tableau des ppts dans l'algo => Non 
- R√©cuperer le code de contr√¥le global pour y ajouter l'aklgo de modif du rapport cyclique 




- Ajouter le tableau des ppts dans l'algo => donner une cible √† l'algo 

pour le moment cet algo fonctionne sur le principe d'oberver les pertubations  => utiliser le tableau de valeurs de r√©ference de mppt reviendrait √† converger vers une cible

- voir tableau convergence VS 

----------on arrete tout ------------
On doit pourvoir utiliser un panneau solaire differents +  on a vu l'influence de facteur exterieurs == on ne doit pas avoir une donn√©e fixe d'entr√©e.


- R√©cuperer le code de contr√¥le global pour y ajouter l'aklgo de modif du rapport cyclique 


